#### 页面渲染过程

![页面渲染过程图](files/img/%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B%E5%9B%BE.jpg)

- 解析 HTML 构建 DOM Tree
- 解析 CSS 构建 CSSOM Tree
- 构建渲染树（ Render Tree ），渲染树只包含渲染网页所需要的节点

##### 为构建渲染树，浏览器大体上完成了下列工作：

1. 从 DOM 树的根节点开始遍历每个可见节点：
   - 某些节点不可见（例如脚本标记、元标记等），因为它们不会体现的渲染输出中，所以会被忽略；
   - 某些节点通过 CSS 隐藏（例如：display：none），因此在渲染树中也会被忽略；
2. 对于每个可见节点，为其找到适配的 CSSOM 规则并应用它们；
3. 发射可见节点，连同其内容和计算的样式；

##### <font color=red>注意：</font>

- visibility：hidden 与 display：none 是不一样的，前者隐藏元素，但元素仍占据着布局空间（即渲染成一个空框），而后者（display：none）元素是从渲染树中完全移除，元素不可见，也不是布局组成部分；
- 最终输出的渲染同时包含屏幕上的所有可见内容及其样式信息，有了渲染树，我们就可以进入布局阶段；
  - 布局计算每个 DOM 对象的精确位置和大小；
  - 渲染（绘制，合成），使用最终渲染树渲染到屏幕上；

#### 回流（Reflow）

- 概念：

  当渲染树 Reader Tree 中的一部分（或全部）因为元素的规模<font color=red>**尺寸**，**布局**，**隐藏**</font>等改变而需要<font color=red>**重新构建**</font>。

- 每个页面至少需要一次回流，就是在页面第一次加载的时候，这时候是一定会发生回流的，因为要构建 render tree ，在回流的时候，浏览器会使渲染树中受到影响的部分失效，并重新构造这部分渲染树，完成回流后，浏览器会重新绘制受影响的部分到屏幕中，该过程称为**重会**。

- **回流就是计算元素在设备内的确切位置和大小并重新绘制**。

- **回流的代价要远大于重绘，并且回流必然会造成重绘，但重绘不一定造成回流**。



